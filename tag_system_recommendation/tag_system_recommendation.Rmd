---
title: "tag_system_recommendation"
author: "Shaocong Zhang"
date: "11/22/2021"
output: html_document
---

Data wrangling on tags

```{r}
library(tidyverse)
```

```{r}
# data import
movies = read_csv("../data/small/movies.csv")
ratings = read_csv("../data/small/ratings.csv")
tags = read_csv("../data/small/tags.csv")
```

```{r}
# data wrangling
tags.user = 
  tags %>%
  janitor::clean_names() %>%
  mutate(
    tag = strsplit(tag, " ")
  ) %>%
  select(user_id, movie_id, tag) %>%
  nest(data = tag) 
  

tags.movie = 
  tags %>%
  janitor::clean_names() %>%
  mutate(
    tag = strsplit(tag, " ")
  ) %>%
  select(user_id, movie_id, tag) %>%
  nest(data = c(user_id,tag))

tags.full = 
  tags %>%
  janitor::clean_names() %>%
  mutate(
    tag = strsplit(tag, " ")
  ) %>%
  unnest()
```


```{r}
interest.fc = function(u, i) {
test.dat = 
  tags.full %>%
  filter(user_id == u,
         movie_id == i)

test.moive = 
  tags.full %>%
  filter(movie_id == i)

interest = c()
for (b in 1:nrow(test.dat)) {
  tag = as.character(test.dat[b,3])
  n_ub = sum(test.dat$tag == tag)
  n_bi = sum(test.moive$tag == tag)
  interest[b] = n_ub*n_bi
}


return(interest = sum(interest))
}
```

```{r}
test = 
  tags.user %>%
  filter(
    user_id <= 20
  ) %>%
  select(-data)

interest = c()

for (j in 1:nrow(test)) {
  u = as.numeric(test[j,1])
  i = as.numeric(test[j,2])
  interest[j] = interest.fc(u, i)
}
  
interest

test = 
  test %>%
  mutate(
    interest = interest
  )
```





